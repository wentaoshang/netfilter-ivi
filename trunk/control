#!/bin/sh

if [ ! -f modules/ivi_map.ko ] ; then
	echo "Error: please make modules first."
	exit 1
fi

start() {
	if ( lsmod | grep "ivi_map" ) ; then
		echo "Error: modules exist, run 'control restart' instead."
		exit 1
	fi
	echo "Starting IVI modules: "
	insmod modules/ivi_map.ko
	insmod modules/ivi_xmit.ko
	insmod modules/ivi_nf.ko
	insmod modules/ivi_ioctl.ko
	if [ ! -e /dev/ivi ] ; then
		mknod /dev/ivi c 90 0
	fi
	return 0
}

stop() {
	if ( lsmod | grep "ivi_map" ) ; then
		echo "Stopping IVI modules: "
		rmmod ivi_ioctl
		rmmod ivi_nf
		rmmod ivi_xmit
		rmmod ivi_map
	else
		echo "Error: modules do not exist."
	fi
	return 0
}

case "$1" in 
	start)
		start
		;;
	stop)
		stop
		;;
	restart|reload)
		stop
		start
		;;
	*)
		echo "Usage: control {start|stop|restart|reload}"
		exit 1
esac

exit 0
